\perusalgoritmi

\Input{Puun solmu $s$,\\ piste $p$, jolla on sijainti $(x,y,z)$ ja väri $(r,g,b)$}

$i \gets$ sen ruudukon solun indeksi, jossa piste sijaitsee\\
$h \gets$ hajautustaulu, johon solmun $s$ pisteet tallennetaan\\

\uIf{Solmun $s$ syvyys = puun enimmäissyvyys}{
    \eIf{$i \notin h$} {
        lisää $i$ ja $(r,g,b)$ hajautustauluun $h$
    }{
        Hylkää piste $p$
    }
}

\uElseIf{$s$ on täynnä}{
    $l \gets$ uusi lapsisolmu\\
    \Return{LisääPisteSolmuun($l, p$)}
 }

\uElseIf{$i \in h$}{
    $l \gets$ uusi lapsisolmu\\
    \Return{LisääPisteSolmuun($l, p$)}
 }

\uElseIf{$\epsilon >$ ennalta määrätty enimmäisvirhe}{
    $l \gets$ uusi lapsisolmu\\
    \Return{LisääPisteSolmuun($l, p$)}
}

\Else {
    \kommentti{Solmussa $s$ ja sen ruudukon solussa $i$ on tilaa, eikä virhe $\epsilon$ ole liian suuri. Piste voidaan lisätä solmuun $s$.}
    lisää $i$ ja $(r,g,b)$ hajautustauluun $h$
}